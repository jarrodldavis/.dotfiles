#! /usr/bin/env bash

# Usage: elapsed "some description" logfile.log command --with --args

description=$1
logfile=$2

shift 2

IFS=" " read -r command command_args <<< "$@"

echo "-----elapsed-----" | tee -a "$logfile"
current_time=$(date "+%Y-%m-%d %H:%M:%S")
echo "Started '$description' at $current_time" | tee -a "$logfile"
echo "Executing command '$command $command_args'" | tee -a "$logfile"
echo "-----elapsed-----" | tee -a "$logfile"

if [ -n "$command_args" ]; then
  echo "$command_args" | xargs "$command" 2>&1 | tee -a "$logfile"
else
  "$command" 2>&1 | tee -a "$logfile"
fi

exit_code=${PIPESTATUS[0]}

echo "-----elapsed-----" | tee -a "$logfile"
current_time=$(date "+%Y-%m-%d %H:%M:%S")
echo "Finished '$description' at $current_time with exit code $exit_code" | tee -a "$logfile"
echo "-----elapsed-----" | tee -a "$logfile"
