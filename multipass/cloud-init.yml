#cloud-config
ssh_import_id:
    - gh:jarrodldavis
    - lp:jarrodldavis

package_update: true
package_upgrade: true
package_reboot_if_required: true

packages:
    - git
    - jq
    - unzip
    - man-db
    - gnupg
    - pinentry-curses
    - python
    - zsh

write_files:
    # Configure mDNS
    - content: |
        MulticastDNS=yes
      path: /etc/systemd/resolved.conf
      append: true
    - content: |
        [Match]
        Name=enp0s2

        [Network]
        MulticastDNS=yes
      path: /etc/systemd/network/10-netplan-enp0s2.network.d/multicast.conf

runcmd:
    # Enable mDNS
    - systemctl restart systemd-resolved systemd-networkd

    # Download dotfiles
    - git clone --recurse-submodules "https://github.com/jarrodldavis/dotfiles.git" /opt/github.com/jarrodldavis/dotfiles
    - cd /opt/github.com/jarrodldavis/dotfiles
    - chown -Rv ubuntu:ubuntu .

    # Link config files
    - ./dotbot/bin/dotbot -c install.conf.yaml

    # Install Visual Studio Live Share prerequisites
    - ./scripts/live-share/scripts/linux-prereqs.sh

    # Install tools
    - ./scripts/starship/install/install.sh --yes
    - ./multipass/install-from-github sharkdp bat -x86_64-unknown-linux-gnu.tar.gz bat
    - ./multipass/install-from-github github hub hub-linux-amd64 bin/hub
    - ./multipass/install-from-github so-fancy diff-so-fancy __TARBALL__ diff-so-fancy
    - ./multipass/install-ngrok

    # Configure `ubuntu` user with config files and ZSH
    - passwd -d ubuntu
    - chsh -s $(which zsh) ubuntu
    - sudo -u ubuntu -- ./dotbot/bin/dotbot -c install.conf.yaml
