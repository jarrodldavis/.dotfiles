- defaults:
    shell:
      stdout: true
      stderr: true
      stdin: true
    link:
      create: true
      force: true

- clean: ['~']

- link:
    ~/.bash_profile:
    ~/.bashrc:
    ~/.inputrc:
    ~/.dotfiles-scripts: scripts
    ~/.Brewfile:
    ~/Library/Preferences/topgrade.toml: topgrade.toml
    ~/.gitconfig:
    ~/.gitignore_global:
    ~/.ssh/config: ssh/config
    ~/.gnupg/gpg-agent.conf: gnupg/gpg-agent.conf
    ~/.vimrc:
    ~/.rbenv/default-gems: rbenv/default-gems
    ~/.rbenv/version: rbenv/version
    ~/.web-ext-config.js:
    ~/Library/LaunchAgents/:
      glob: true
      path: LaunchAgents/*

    ~/Library/Application Support/Code/User/settings.json: vscode/settings.json
    ~/Library/Application Support/Code/User/keybindings.json: vscode/keybindings.json
    ~/Library/Application Support/Code/User/snippets: vscode/snippets

    # VS Code's Chrome Debugger doesn't allow for user-scoped `runtimeExecutable` setting
    /Applications/Google Chrome.app/Contents/MacOS/Google Chrome: scripts/bash/open-chromium

- shell:
    -
      command: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
      description: Installing Homebrew
    -
      command: brew bundle --global --verbose
      description: Installing packages from Homebrew Bundle
    -
      command: grep '/usr/local/bin/bash' /etc/shells || echo /usr/local/bin/bash | sudo tee -a /etc/shells
      description: Adding Homebrew bash to system shells
    -
      command: sudo chsh -s /usr/local/bin/bash $(whoami)
      description: Setting default shell to Homebrew bash
    -
      command: chmod -vv u=rwx,go= ~/.gnupg && chmod -vv u=rw,go= ~/.gnupg/* && gpgconf --kill gpg-agent
      description: Setting correct permissions for GnuPG homedir
    -
      command: chmod -vv u=rwx,go= ~/.ssh && chmod -vv u=rw,go= ~/.ssh/*
      description: Setting correct permissions for SSH directory
    -
      command: 'cat rbenv/versions.txt | xargs -L1 rbenv install --verbose --skip-existing'
      description: Installing rbenv-managed rubies
    -
      command: rustup-init -y --no-modify-path
      description: Installing Rust
    -
      command: rustup component add clippy rls rust-analysis rust-src rustfmt
      description: Installing additional Rust components
    -
      command: command -v cargo-install-update || cargo install cargo-update
      description: Installing `cargo-update`
    -
      command: cat cargo-bins.txt | xargs cargo install-update --allow-no-update
      description: Installing additional Cargo-managed binaries
    -
      command: '[ -d ~/.vim/bundle/Vundle.vim/ ] || git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim'
      description: Installing Vundle
    -
      command: vim +PluginInstall +qall &>/dev/null
      description: Installing vim plugins
    -
      command: cat vim-press-and-hold.txt | xargs -I {} defaults write {} ApplePressAndHoldEnabled -bool false
      description: Fixing Keyboard Press and Hold for apps with vim plugins
    -
      command: code $(sed -e 's/^/--force --install-extension /' vscode/extensions.txt)
      description: Installing Visual Studio Code Extensions
    -
      command: cat npm-config.txt | xargs -L1 npm config set
      description: Configuring npm
    -
      command: cat npm-globals.txt | xargs npm i -g
      description: Installing global npm packages
    -
      command: heroku plugins:install $(cat heroku-plugins.txt)
      description: Installing Heroku CLI plugins
